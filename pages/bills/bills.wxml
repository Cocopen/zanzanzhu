<!--pages/bills/bills.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <view class="header-section fade-in">
    <view class="title-section">
      <text class="title-large">è´¦å•æ˜ç»†</text>
      <text class="subtitle">è®°å½•æ¯ä¸€ç¬”æ¶ˆè´¹</text>
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar slide-up anim-delay-1">
    <view class="filter-card glass">
      <view class="filter-item {{filterType === 'all' ? 'active' : ''}}" bindtap="switchFilter" data-type="all">
        <text class="filter-text">å…¨éƒ¨</text>
      </view>
      <view class="filter-item {{filterType === 'income' ? 'active' : ''}}" bindtap="switchFilter" data-type="income">
        <text class="filter-text text-green">æ”¶å…¥</text>
      </view>
      <view class="filter-item {{filterType === 'expense' ? 'active' : ''}}" bindtap="switchFilter" data-type="expense">
        <text class="filter-text text-red">æ”¯å‡º</text>
      </view>
    </view>
  </view>

  <!-- æœˆä»½é€‰æ‹© -->
  <view class="month-selector slide-up anim-delay-2">
    <view class="month-card glass">
      <view class="flex-center" bindtap="prevMonth">
        <text class="icon-arrow-left"></text>
      </view>
      <view class="month-text">
        <text class="text-base font-semibold">{{currentYear}}å¹´{{currentMonth}}æœˆ</text>
      </view>
      <view class="flex-center" bindtap="nextMonth">
        <text class="icon-arrow-right"></text>
      </view>
    </view>
  </view>

  <!-- è´¦å•åˆ—è¡¨ -->
  <view class="bills-section slide-up anim-delay-3">
    <view class="empty" wx:if="{{groupedBills.length === 0}}">
      <text class="empty-icon">ğŸ“</text>
      <text class="text-gray text-lg mt-lg">æš‚æ— è´¦å•è®°å½•</text>
      <text class="text-gray text-sm mt-sm">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹è®°è´¦</text>
    </view>

    <view class="bill-group" wx:for="{{groupedBills}}" wx:key="date">
      <!-- æ—¥æœŸåˆ†ç»„æ ‡é¢˜ -->
      <view class="group-header">
        <text class="group-date text-base font-semibold">{{item.date}}</text>
        <text class="group-total text-sm text-gray">æ”¯å‡ºÂ¥{{item.expense}} æ”¶å…¥Â¥{{item.income}}</text>
      </view>

      <!-- è´¦å•åˆ—è¡¨ -->
      <view class="bills-list">
        <view 
          class="bill-item card-entrance" 
          wx:for="{{item.bills}}" 
          wx:key="id" 
          wx:for-item="bill"
          wx:for-index="billIdx"
          style="animation-delay: {{billIdx * 0.05}}s"
          bindtap="goToDetail"
          data-id="{{bill.id}}"
        >
          <view class="bill-icon" style="background: {{bill.category.color}}20">
            <text class="bill-icon-text" style="color: {{bill.category.color}}">{{bill.category.icon}}</text>
          </view>
          <view class="bill-info">
            <view class="bill-header">
              <text class="bill-name text-base font-medium">{{bill.category.name}}</text>
              <text class="bill-amount text-lg font-semibold {{bill.type === 'expense' ? 'text-red' : 'text-green'}}">
                {{bill.type === 'expense' ? '-' : '+'}}Â¥{{bill.amount}}
              </text>
            </view>
            <view class="bill-detail">
              <text class="bill-account text-sm text-gray">{{bill.account.name}}</text>
              <text class="bill-time text-sm text-gray">{{bill.time}}</text>
            </view>
            <view class="bill-remark" wx:if="{{bill.remark}}">
              <text class="text-sm text-gray">{{bill.remark}}</text>
            </view>
          </view>
          <view class="bill-arrow">
            <text class="icon-arrow">â€º</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card slide-up anim-delay-4" wx:if="{{groupedBills.length > 0}}">
    <view class="card glass">
      <view class="stats-header flex-between mb-md">
        <text class="text-base font-semibold">æœ¬æœˆç»Ÿè®¡</text>
        <text class="text-sm text-gray">{{currentYear}}å¹´{{currentMonth}}æœˆ</text>
      </view>
      <view class="stats-content">
        <view class="stat-item">
          <text class="stat-label text-sm text-gray">æ€»æ”¶å…¥</text>
          <text class="stat-value text-xl font-semibold text-green">Â¥{{monthStats.income}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label text-sm text-gray">æ€»æ”¯å‡º</text>
          <text class="stat-value text-xl font-semibold text-red">Â¥{{monthStats.expense}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label text-sm text-gray">ç»“ä½™</text>
          <text class="stat-value text-xl font-semibold text-blue">Â¥{{monthStats.balance}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label text-sm text-gray">ç¬”æ•°</text>
          <text class="stat-value text-xl font-semibold">{{monthStats.count}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿè®°è´¦æŒ‰é’® -->
  <view class="fab" bindtap="goToAdd">
    <text class="fab-icon">+</text>
  </view>
</view>

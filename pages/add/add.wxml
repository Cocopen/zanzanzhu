<!--pages/add/add.wxml-->
<view class="container">
  <!-- æ”¶æ”¯ç±»å‹åˆ‡æ¢ -->
  <view class="type-switch glass slide-up">
    <view class="switch-item {{billType === 'expense' ? 'active' : ''}}" bindtap="switchType" data-type="expense">
      <text class="switch-text">æ”¯å‡º</text>
    </view>
    <view class="switch-item {{billType === 'income' ? 'active' : ''}}" bindtap="switchType" data-type="income">
      <text class="switch-text">æ”¶å…¥</text>
    </view>
  </view>

  <!-- é‡‘é¢è¾“å…¥åŒºåŸŸ -->
  <view class="amount-section slide-up anim-delay-1">
    <view class="amount-wrapper">
      <text class="amount-symbol">Â¥</text>
      <input 
        class="amount-input" 
        type="digit" 
        placeholder="0.00" 
        value="{{amount}}" 
        bindinput="onAmountInput"
        focus="{{amountFocus}}"
      />
    </view>
  </view>

  <!-- åˆ†ç±»é€‰æ‹© -->
  <view class="category-section slide-up anim-delay-2">
    <view class="section-title text-lg font-semibold mb-md">é€‰æ‹©åˆ†ç±»</view>
    
    <view class="category-grid">
      <view
        class="category-item {{selectedCategory._id === item._id ? 'active' : ''}}"
        wx:for="{{categories}}"
        wx:key="_id"
        bindtap="selectCategory"
        data-category="{{item}}"
      >
        <view class="category-icon" style="background: {{item.color}}20; {{selectedCategory._id === item._id ? 'background: ' + item.color + '' : ''}}">
          <text class="category-icon-text" style="color: {{selectedCategory._id === item._id ? '#fff' : item.color}}">{{item.icon}}</text>
        </view>
        <text class="category-name text-sm {{selectedCategory._id === item._id ? 'text-blue font-semibold' : ''}}">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- é™„åŠ é€‰é¡¹ -->
  <view class="options-section slide-up anim-delay-3">
    <!-- è´¦æˆ·é€‰æ‹© -->
    <view class="option-item" bindtap="showAccountPicker">
      <view class="option-left">
        <view class="option-icon-wrapper">
          <text class="option-icon">ğŸ’³</text>
        </view>
        <text class="option-label text-base">è´¦æˆ·</text>
      </view>
      <view class="option-right">
        <text class="option-value text-base text-gray">{{selectedAccount.name || 'é€‰æ‹©è´¦æˆ·'}}</text>
        <text class="option-arrow">â€º</text>
      </view>
    </view>

    <!-- æ—¥æœŸé€‰æ‹© -->
    <picker 
      mode="date" 
      value="{{selectedDate}}" 
      bindchange="onDateChange"
      start="2000-01-01"
      end="2030-12-31"
    >
      <view class="option-item">
        <view class="option-left">
          <view class="option-icon-wrapper">
            <text class="option-icon">ğŸ“…</text>
          </view>
          <text class="option-label text-base">æ—¥æœŸ</text>
        </view>
        <view class="option-right">
          <text class="option-value text-base text-gray">{{selectedDate || 'ä»Šå¤©'}}</text>
          <text class="option-arrow">â€º</text>
        </view>
      </view>
    </picker>

    <!-- å¤‡æ³¨ -->
    <view class="option-item" bindtap="showRemarkInput">
      <view class="option-left">
        <view class="option-icon-wrapper">
          <text class="option-icon">ğŸ“</text>
        </view>
        <text class="option-label text-base">å¤‡æ³¨</text>
      </view>
      <view class="option-right">
        <text class="option-value text-base text-gray">{{remark || 'æ·»åŠ å¤‡æ³¨'}}</text>
        <text class="option-arrow">â€º</text>
      </view>
    </view>
  </view>

  <!-- å®ŒæˆæŒ‰é’® -->
  <view class="submit-section slide-up anim-delay-4">
    <button class="btn submit-btn" bindtap="submitBill" disabled="{{!canSubmit}}">
      {{billId ? 'æ›´æ–°' : 'å®Œæˆ'}}
    </button>
    
    <!-- åˆ é™¤æŒ‰é’®ï¼ˆä»…ç¼–è¾‘æ¨¡å¼æ˜¾ç¤ºï¼‰ -->
    <button class="btn delete-btn" wx:if="{{billId}}" bindtap="deleteBill">
      åˆ é™¤
    </button>
  </view>
</view>

<!-- åº•éƒ¨å¼¹çª—ï¼šå¤‡æ³¨è¾“å…¥ -->
<view class="modal {{showRemarkModal ? 'show' : ''}}" bindtap="closeRemarkModal">
  <view class="modal-content glass" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title text-lg font-semibold">æ·»åŠ å¤‡æ³¨</text>
      <text class="modal-close" bindtap="closeRemarkModal">Ã—</text>
    </view>
    <view class="modal-body">
      <textarea 
        class="remark-input" 
        placeholder="è¯·è¾“å…¥å¤‡æ³¨å†…å®¹..." 
        value="{{remark}}" 
        bindinput="onRemarkInput"
        maxlength="100"
      ></textarea>
    </view>
    <view class="modal-footer">
      <button class="btn modal-btn" bindtap="confirmRemark">ç¡®å®š</button>
    </view>
  </view>
</view>
